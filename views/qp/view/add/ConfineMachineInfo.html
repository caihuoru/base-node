<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width"/>
    <title>后台管理-限制机器码管理</title>
    <link href="../../Content/Admin/css/bootstrap-cerulean.min.css" rel="stylesheet"/>
    <link href="../../Content/Admin/css/charisma-app.css" rel="stylesheet"/>
    <link href="../../Content/common.css" rel="stylesheet"/>
    <style type="text/css">
        .panel-body .row {
            margin: 15px 0;
        }

        .panel-body .row div:first-child {
            text-align: right;
            min-width: 120px;
        }

        .btn-outline-primary {
            border-right: 1px solid rgba(0, 0, 0, 0.3);
        }
        body{
            overflow-y: scroll!important;
        }
    </style>
</head>
<body>
<div id="content" class="main-content">
    <div class="">
        <div class="carousel box-inner">
            <div class="box-header well clearfix" data-original-title="">
                <h2><i class="glyphicon glyphicon-hand-right"></i>目前操作功能：后台管理-限制机器码管理</h2>
            </div>
            <div class="tab-content padding-margin-0">
                <div class="panel panel-primary no-bord">
                    <div class="panel-heading no-bord-radio">
                        <h3 class="panel-title">后台管理-限制机器码管理</h3>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-xs-2 col-md-1">限制机器码：</div>
                            <div class="col-xs-6 col-md-3">
                                <input id="txtString" style="width:350px;display:inline;"
                                       class="form-control input-sm" type="text"
                                       maxlength="32" value=""></div>
                            <div class="col-xs-4 col-md-2" style="text-align:left"></div>
                        </div>
                        <div class="row">
                            <div class="col-xs-2 col-md-1">选项：</div>
                            <div class="col-xs-6 col-md-3">
                                <p class="checkbox-radio">
                                        <span class="break-word">
                                            <input type="checkbox" id="ckbEnjoinLogon" checked/>
                                            <label for="ckbEnjoinLogon">限制登录</label>
                                        </span>
                                    <span class="break-word">
                                            <input type="checkbox" id="ckbEnjoinRegister" checked/>
                                            <label for="ckbEnjoinRegister">限制注册</label>
                                        </span>
                                </p>

                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-2 col-md-1">失效时间：</div>
                            <div class="col-xs-6 col-md-3">
                                <input id="txtEnjoinOverDate"
                                       style="width: 350px; display: inline;"
                                       class="" type="text"
                                       readonly="readonly" placeholder="请输入时间" value=""/>
                            </div>
                            <div class="col-xs-4 col-md-2" style="text-align:left"></div>
                        </div>
                        <div class="row">
                            <div class="col-xs-2 col-md-1">警告：</div>
                            <div class="col-xs-8 col-md-8"><span style="color:red;">失效时间不填写，则默认为永久限制</span></div>
                        </div>
                        <div class="row">
                            <div class="col-xs-2 col-md-1">备注：</div>
                            <div class="col-xs-6 col-md-3">
                                <textarea class="form-control" id="txtCollectNote"
                                          style="width:350px;display:inline;" rows="5"
                                          placeholder="备注" maxlength="32"></textarea></div>
                        </div>
                    </div>
                    <ul class="list-group">
                        <li class="list-group-item">
                            <ul class="list-inline">
                                <li><a class="btn btn-outline-primary search btn-md" href="../xianZhiJiQiMa.html"><i
                                        class="glyphicon glyphicon-circle-arrow-left"></i>返回</a></li>
                                <li><a class="btn btn-outline-success search btn-md" href="#" onclick="add();"><i
                                        class="glyphicon glyphicon-send"></i>保存</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>

        </div>
    </div>
</div>
<script src="../../Scripts/jquery-1.10.2.min.js"></script>
<script src="../../Scripts/comm.js"></script>
<script src="../../Content/laydate/laydate.js"></script>
<script src="../../Content/layui-v2.5.4/layui/layui.js"></script>
<script type="text/javascript">
    layui.use(['layer'], function () {
        var layer = layui.layer
    })
    $(function () {
        laydate.render({
            elem: '#txtEnjoinOverDate'
            , type: 'datetime'
            , theme: '#00B4E5'
        });
        var param = getUrlParams('param')
        if (param.length > 0) {
            var obj = JSON.parse(getStorage('JQM'))
            $("#txtString").val(param);
            $("#txtEnjoinOverDate").val(obj.EnjoinOverDate);
            $("#txtCollectNote").val(obj.CollectNote);
            $('#ckbEnjoinLogon').prop("checked", obj.EnjoinLogon == 1);
            $('#ckbEnjoinRegister').prop("checked", obj.EnjoinRegister == 1);
            // delStorage(JQM)
        }
    })

    function add() {
        var EnjoinOverDatestr = $("#txtEnjoinOverDate").val();
        var String = $("#txtString").val();
        if (String == "") {
            layer.alert("限制机器码不能为空");
            return false;
        }
        if (EnjoinOverDatestr != "") {
            if (EnjoinOverDatestr <= Time.today().NowDate) {
                layer.alert("失效时间不能小于当前时间");
                return false;
            }
        }
        var CollectNote = $("#txtCollectNote").val();
        var data = {
            String: String,
            EnjoinOverDate: EnjoinOverDatestr == '永久限制' ? '' : EnjoinOverDatestr,
            Param: getUrlParams('param') || '',
            CollectNote: CollectNote
        };
        data.EnjoinLogon = $('#ckbEnjoinLogon').is(':checked') ? 1 : 0;
        data.EnjoinRegister = $('#ckbEnjoinRegister').is(':checked') ? 1 : 0;
        data.token = getStorage('token')
        $.ajax({
            type: 'POST',
            url: qp_url + 'admin/Account/AddConfineMachineInfo?token='+getStorage('token'),
            data: data,
            dataType: 'json',
            success: function (res) {
                if (res.status == 1) {
                    layer.msg(res.msg, {time: 1000, icon: 1})
                    setTimeout(function () {
                        window.location.href = '../xianZhiJiQiMa.html'
                    }, 1000)
                } else {
                    layer.msg(res.msg, {time: 1000, icon: 2})
                }
            }
        })
    }

    function callBack(jsonData, fname) {
        switch (fname) {
            case "add":
                alert(jsonData.Msg);
                location.href = '/Account/ConfineMachineList?ModuleID=106'
                break;
        }
    }

    function StrToDateTime(timestr) {
        var dt = new Date(timestr.replace("-", "/").replace("-", "/"));
        return dt;
    }
</script>
</body>
</html>
